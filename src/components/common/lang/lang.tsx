"use client";

import { ReactNode, useTransition } from "react";

import { useLocale } from "next-intl";

import { Button } from "@/components/_ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/_ui/dropdown-menu";

import updateLocale from "@/actions/website/update-locale";
import { completeLocale } from "@/lang/locales";
import { Locale } from "@/types/locale";

export default function Lang(): ReactNode {
  const [pending, startTransition] = useTransition();
  const locale: string = useLocale();

  const handleClick = (lang: Locale): void =>
    startTransition(async (): Promise<void> => {
      const res: boolean = await updateLocale(lang);
      if (!res) alert("The website failed to update the updateLocale, please submit issue.");
    });

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild={true} className={"fixed bottom-4 right-4 sm:bottom-8 sm:right-8"}>
        <Button variant={"default"} className={"[&_svg]:size-auto"} size={"icon"}>
          <svg width="25" height="25" viewBox="0 0 51 51" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M25.5 0.5C20.5555 0.5 15.722 1.96622 11.6108 4.71326C7.49953 7.46029 4.29521 11.3647 2.40302 15.9329C0.510831 20.501 0.0157492 25.5277 0.98038 30.3772C1.94501 35.2267 4.32603 39.6813 7.82234 43.1776C11.3187 46.6739 15.7732 49.055 20.6228 50.0197C25.4723 50.9843 30.4989 50.4892 35.0671 48.597C39.6353 46.7049 43.5397 43.5005 46.2868 39.3893C49.0338 35.2781 50.5 30.4445 50.5 25.5C50.5 18.8696 47.8661 12.5108 43.1777 7.82239C38.4893 3.13398 32.1304 0.5 25.5 0.5ZM38.36 24.77C38.3322 21.7075 37.9972 18.6556 37.36 15.66C39.0808 16.1449 40.7542 16.7841 42.36 17.5699C46.36 19.5699 48.66 22.09 49.01 24.77H38.36ZM36.9 24.77H26.23V14.1C29.4385 14.1347 32.6338 14.5169 35.76 15.24C36.4831 18.3662 36.8653 21.5615 36.9 24.77ZM26.23 12.64V2.01001C28.91 2.36001 31.45 4.70003 33.43 8.66003C34.2159 10.2658 34.8551 11.9393 35.34 13.66C32.3451 13.0161 29.2932 12.6744 26.23 12.64ZM24.77 2.01001V12.64C21.7075 12.6678 18.6556 13.0028 15.66 13.64C16.1449 11.9193 16.7842 10.2458 17.57 8.64001C19.55 4.70001 22.09 2.36001 24.77 2.01001ZM24.77 14.1V24.77H14.1C14.1347 21.5615 14.5169 18.3662 15.24 15.24C18.3662 14.5169 21.5615 14.1347 24.77 14.1ZM12.64 24.77H2.01001C2.36001 22.09 4.70001 19.5499 8.66001 17.5699C10.2658 16.7841 11.9393 16.1449 13.66 15.66C13.0161 18.6549 12.6744 21.7069 12.64 24.77ZM12.64 26.23C12.6678 29.2925 13.0028 32.3444 13.64 35.34C11.9193 34.8551 10.2458 34.2159 8.64001 33.4301C4.64001 31.4301 2.34001 28.91 1.99001 26.23H12.64ZM14.1 26.23H24.77V36.9C21.5615 36.8653 18.3662 36.4831 15.24 35.76C14.5169 32.6338 14.1347 29.4385 14.1 26.23ZM24.77 38.36V48.99C22.09 48.64 19.55 46.3 17.57 42.34C16.7842 40.7342 16.1449 39.0607 15.66 37.34C18.6549 37.9839 21.7069 38.3256 24.77 38.36ZM26.23 48.99V38.36C29.2925 38.3322 32.3444 37.9972 35.34 37.36C34.8551 39.0807 34.2159 40.7542 33.43 42.36C31.5 46.3 28.91 48.64 26.23 48.99ZM26.23 36.9V26.23H36.9C36.8653 29.4385 36.4831 32.6338 35.76 35.76C32.6338 36.4831 29.4385 36.8653 26.23 36.9ZM38.36 26.23H48.99C48.64 28.91 46.3 31.4501 42.34 33.4301C40.7342 34.2159 39.0608 34.8551 37.34 35.34C37.9839 32.3451 38.3257 29.2931 38.36 26.23ZM48.5 20.37C46.9719 18.6398 45.1028 17.244 43.01 16.27C41.0915 15.3235 39.081 14.5762 37.01 14.04C36.4738 11.969 35.7266 9.95852 34.78 8.04004C33.8026 5.94928 32.4072 4.08089 30.68 2.55005C35.0292 3.53614 39.0105 5.73274 42.1639 8.88611C45.3172 12.0395 47.5139 16.0208 48.5 20.37ZM20.37 2.5C18.6399 4.02812 17.244 5.89717 16.27 7.98999C15.3235 9.90847 14.5762 11.919 14.04 13.99C11.969 14.5262 9.95849 15.2734 8.04001 16.22C5.94719 17.194 4.07813 18.5898 2.55001 20.3199C3.53611 15.9708 5.73278 11.9896 8.88615 8.83618C12.0395 5.68281 16.0209 3.4861 20.37 2.5ZM2.50001 30.63C4.02813 32.3602 5.89719 33.756 7.99001 34.73C9.90849 35.6765 11.919 36.4238 13.99 36.96C14.5262 39.031 15.2735 41.0415 16.22 42.96C17.194 45.0528 18.5899 46.9218 20.32 48.45C15.9709 47.4639 11.9895 45.2673 8.83615 42.1139C5.68278 38.9605 3.48611 34.9792 2.50001 30.63ZM30.63 48.5C32.3572 46.9692 33.7526 45.1008 34.73 43.01C35.6766 41.0915 36.4238 39.081 36.96 37.01C39.031 36.4738 41.0415 35.7266 42.96 34.78C45.0528 33.806 46.9219 32.4102 48.45 30.6801C47.4639 35.0292 45.2672 39.0104 42.1139 42.1638C38.9605 45.3172 34.9792 47.5139 30.63 48.5Z"
              fill="currentColor"
            />
          </svg>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align={"end"}>
        {completeLocale.map((item) => (
          <DropdownMenuItem
            key={item.lang}
            onClick={() => handleClick(item.lang)}
            disabled={item.lang === locale || pending}
            className="cursor-pointer"
          >
            {item.name}
          </DropdownMenuItem>
        ))}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
